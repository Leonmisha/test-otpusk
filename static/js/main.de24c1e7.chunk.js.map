{"version":3,"sources":["components/Main/Main.module.css","components/Auth/Auth.module.css","components/Main/Header.module.css","components/Main/Card.module.css","utils/sdk.js","redux/actions.js","components/Auth/Auth.js","components/Main/Header.js","components/Main/Card.js","components/Main/Main.js","App.js","redux/store.js","index.js"],"names":["module","exports","TOKEN_SECRET_HASH","createToken","email","password","btoa","JSON","stringify","concat","parseToken","token","atob","split","user","secret","parse","validateToken","Promise","resolve","then","includes","getUser","SAVE_LOGIN_INFO","USER_LOGOUT","saveLoginInfo","type","Auth","props","dispatch","useDispatch","useState","setEmail","setPassword","rememberMe","setRememberMe","showErrorEmail","setShowErrorEmail","showErrorPassword","setShowErrorPassword","apiError","setApiError","validateEmail","enableEmptyValue","isValid","regEx","test","validatePassword","length","className","s","Form","form","Group","controlId","Label","Control","placeholder","value","onChange","e","target","Text","Check","label","checked","Button","variant","loginButton","onClick","preventDefault","Math","random","Response","status","reject","error","message","authenticateUser","response","json","data","localStorage","setItem","err","alert","catch","Header","logout","Card","companyName","date","card","Main","useSelector","state","flights","setFlights","isLoaded","setIsLoaded","search","setSearch","filteredFlights","filter","flight","cond1","company","name","indexOf","cond2","alternativeNames","some","n","useEffect","10","20","getFlights","id","push","sort","a","b","Date","cardsContainer","cards","map","App","isAuth","Boolean","history","useHistory","tokenChecked","setTokenChecked","getNotAuthRedirectURL","location","pathname","getAuthRedirectURL","arg","redirectURL","URLSearchParams","get","getItem","removeItem","checkToken","path","from","to","initialState","store","createStore","action","actions","appReducer","undefined","window","__REDUX_DEVTOOLS_EXTENSION__","ReactDOM","render","StrictMode","basename","process","document","getElementById"],"mappings":"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","file":"static/js/main.de24c1e7.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"Main\":\"Main_Main__aEwJn\",\"cardsContainer\":\"Main_cardsContainer__3P5ZV\",\"cards\":\"Main_cards__1BYCn\",\"search\":\"Main_search__YvnYq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Auth\":\"Auth_Auth__3-Wh1\",\"form\":\"Auth_form__2rGng\",\"loginButton\":\"Auth_loginButton__DrYCx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Header\":\"Header_Header__2dWng\",\"logout\":\"Header_logout__2AWhG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"Card_card__1tnPy\"};","// contants\r\nconst TOKEN_SECRET_HASH = 'qwerty';\r\n\r\nconst createToken = (email, password) => btoa(\r\n  JSON.stringify({\r\n    email,\r\n    password,\r\n  }).concat(`::${TOKEN_SECRET_HASH}`)\r\n);\r\n\r\nconst parseToken = (token) => {\r\n  const [user, secret] = atob(token).split('::');\r\n\r\n  return { user: JSON.parse(user), secret };\r\n};\r\n\r\nexport const authenticateUser = (email, password) => {\r\n  if (Math.random() > 0.5) {\r\n    return Promise.resolve(\r\n      new Response(\r\n        JSON.stringify({ email, token: createToken(email, password) })\r\n      ),\r\n      { status: 200 }\r\n    );\r\n  }\r\n\r\n  return Promise.reject(\r\n    new Response(\r\n      JSON.stringify({ error: true, message: 'Email or password is incorrect' }),\r\n      { status: 401 }\r\n    )\r\n  )\r\n}\r\n\r\nexport const validateToken = (token) => Promise\r\n  .resolve(token)\r\n  .then(parseToken)\r\n  .then(({ secret }) => secret.includes(TOKEN_SECRET_HASH));\r\n\r\nexport const getUser = (token) => Promise\r\n  .resolve(token)\r\n  .then(parseToken)\r\n  .then(({ user }) => {\r\n    delete user.password;\r\n\r\n    return user;\r\n  });\r\n\r\nexport const getFlights = (token) => validateToken(token)\r\n  .then(\r\n    isValid => isValid\r\n      ? new Response(\r\n        JSON.stringify({\r\n          data: {\r\n            10: {\r\n              company: {\r\n                alternativeNames: ['Fdhjhf', 'арорва', 'АРОРВА'],\r\n                name: 'Аврора',\r\n              },\r\n              date: '25-05-2021'\r\n            },\r\n            20: {\r\n              company: {\r\n                alternativeNames: [],\r\n                name: 'Аэрофлот',\r\n              },\r\n              date: '29-05-2021'\r\n            },\r\n          }\r\n        }),\r\n        { status: 200 }\r\n      )\r\n      : new Response(\r\n        JSON.stringify({ error: true, message: 'Forbidden' }),\r\n        { status: 403 }\r\n      )\r\n  )","export const SAVE_LOGIN_INFO = 'SAVE_LOGIN_INFO'\r\nexport const USER_LOGOUT = 'USER_LOGOUT'\r\n\r\nexport const saveLoginInfo = ({ email, token }) =>({\r\n    type: SAVE_LOGIN_INFO,\r\n    email,\r\n    token\r\n})\r\n\r\nexport const userLogout = () => ({\r\n    type: USER_LOGOUT\r\n})","import React, { useState } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport s from './Auth.module.css'\r\n\r\nimport { Form, Button } from 'react-bootstrap';\r\nimport { authenticateUser } from './../../utils/sdk';\r\nimport { saveLoginInfo } from '../../redux/actions';\r\n\r\nconst Auth = props => {\r\n\r\n    const dispatch = useDispatch()\r\n\r\n    const [email, setEmail] = useState('')\r\n    const [password, setPassword] = useState('')\r\n    const [rememberMe, setRememberMe] = useState(false)\r\n\r\n    const [showErrorEmail, setShowErrorEmail] = useState(false)\r\n    const [showErrorPassword, setShowErrorPassword] = useState(false)\r\n    const [apiError, setApiError] = useState(null)\r\n\r\n    function handleSubmit(e) {\r\n        e.preventDefault()\r\n        if (!(validateEmail(false) & validatePassword(false))) {\r\n            return false\r\n        }\r\n        authenticateUser(email, password)\r\n            .then(response => response.json())\r\n            .then(data => {\r\n                if (rememberMe) {\r\n                    try {\r\n                        localStorage.setItem(\"token\", data.token)\r\n                    }\r\n                    catch(err){\r\n                        alert(\"Не вышло запомнить вас! А жаль:(\")\r\n                    }\r\n                }\r\n                dispatch(saveLoginInfo({\r\n                    email: data.email,\r\n                    token: data.token\r\n                }))\r\n        }).catch(response => response.json()\r\n            .then(data => {\r\n                setApiError(data.message)\r\n            })\r\n        )\r\n    }\r\n\r\n    function handleChangeEmail(e) {\r\n        if (showErrorEmail) {\r\n            validateEmail(false)\r\n        }\r\n        setEmail(e.target.value)\r\n    }\r\n\r\n    function handleChangePassword(e) {\r\n        if (showErrorPassword) {\r\n            validatePassword(false)\r\n        }\r\n        setPassword(e.target.value)\r\n    }\r\n\r\n    function handleChangeRemember(e) {\r\n        setRememberMe(e.target.checked)\r\n    }\r\n\r\n    function validateEmail(enableEmptyValue=true) {\r\n        let isValid = true\r\n        const regEx = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;\r\n        if ((!enableEmptyValue && !email) || !regEx.test(email)) {\r\n            isValid = false\r\n        } else {\r\n            isValid = true\r\n        }\r\n        setShowErrorEmail(!isValid)\r\n        return isValid\r\n\r\n    }\r\n\r\n    function validatePassword(enableEmptyValue=true) {\r\n        let isValid = true\r\n        if ((!enableEmptyValue && !password) || password.length < 3) {\r\n            isValid = false\r\n        } else {\r\n            isValid = true\r\n        }\r\n        setShowErrorPassword(!isValid)\r\n        return isValid\r\n    }\r\n\r\n    return (\r\n        <div className={s.Auth}>\r\n            <Form className={s.form}>\r\n                <Form.Group controlId=\"email\">\r\n                    <Form.Label>Email</Form.Label>\r\n                    <Form.Control type=\"email\" placeholder=\"Например tourist@gmail.com\" value={email} onChange={handleChangeEmail}/>\r\n                    {showErrorEmail && <Form.Text className=\"text-muted\">Некорректная почта</Form.Text>}\r\n                </Form.Group>\r\n                <Form.Group controlId=\"password\">\r\n                    <Form.Label>Пароль</Form.Label>\r\n                    <Form.Control type=\"password\" placeholder=\"Пароль\" value={password} onChange={handleChangePassword} />\r\n                    {showErrorPassword && <Form.Text className=\"text-muted\">Пароль должен состоять из 3 и более символов</Form.Text>}\r\n                </Form.Group>\r\n                <Form.Group controlId=\"rememberMe\">\r\n                    <Form.Check type=\"checkbox\" label=\"Запомнить меня\" value={rememberMe} onChange={handleChangeRemember} />\r\n                </Form.Group>\r\n                <Button variant=\"primary\" type=\"submit\" className={s.loginButton} onClick={handleSubmit}>\r\n                    Войти\r\n                </Button>\r\n                {apiError && <Form.Text>{apiError}</Form.Text>}\r\n            </Form>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Auth","\r\nimport React from 'react'\r\nimport PropTypes from \"prop-types\";\r\nimport s from './Header.module.css'\r\nimport { useDispatch } from 'react-redux';\r\nimport { userLogout } from '../../redux/actions';\r\nimport { Button } from 'react-bootstrap';\r\nconst Header = ({ email }) => {\r\n    const dispatch = useDispatch()\r\n\r\n    function logout() {\r\n        dispatch(userLogout())\r\n    }\r\n  \r\n  return (\r\n    <header className={s.Header}>\r\n        <div className={s.email}>{email}</div>\r\n        <Button className={s.logout} onClick={logout} variant=\"light\">Выход</Button>\r\n    </header>\r\n)}\r\n\r\nHeader.propTypes = {\r\n    email: PropTypes.string\r\n}\r\n\r\nexport default Header","\r\nimport React from 'react'\r\nimport s from './Card.module.css'\r\nimport { PropTypes } from 'prop-types';\r\nconst Card = ({ companyName, date }) => {\r\n  \r\n  return (\r\n    <div className={s.card}>\r\n      <div className={s.companyName}>{companyName}</div>\r\n      <div className={s.date}>{date}</div>\r\n    </div>\r\n)}\r\n\r\nCard.propTypes = {\r\n  companyName: PropTypes.string,\r\n  date: PropTypes.string\r\n}\r\n\r\nexport default Card","\r\nimport React, { useEffect, useState } from 'react'\r\nimport s from './Main.module.css'\r\nimport { useSelector } from 'react-redux'\r\nimport Header from './Header';\r\nimport { getFlights } from '../../utils/sdk';\r\nimport Card from './Card';\r\nimport { Form } from 'react-bootstrap';\r\n\r\nconst Main = () => {\r\n  const token = useSelector( state => state.token)\r\n  const email = useSelector( state => state.email)\r\n  const [flights, setFlights] = useState([])\r\n  const [isLoaded, setIsLoaded] = useState(false)\r\n  const [search, setSearch] = useState('')\r\n\r\n  let filteredFlights = flights.filter( flight => {\r\n    if (!search) {\r\n      return flight\r\n    }\r\n    let cond1 = flight.company.name.indexOf(search) !== -1\r\n    let cond2 = flight.company.alternativeNames.some( n => n.indexOf(search) !== -1)\r\n    return (cond1 || cond2)\r\n  })\r\n\r\n  useEffect( () => {\r\n    getFlights(token).then(response => response.json())\r\n      .then(data => {\r\n        let flights = []\r\n        for (let id in data.data) {\r\n          flights.push({id, ...data.data[id]})\r\n        }\r\n        flights = flights.sort( (a, b) => {\r\n          return new Date(a.date) - new Date(b.date)\r\n        })\r\n        setFlights(flights)\r\n        setIsLoaded(true)\r\n      })\r\n  }, [token])\r\n\r\n  function handleChangeSearch(e) {\r\n    setSearch(e.target.value)\r\n  }\r\n\r\n  return (\r\n    <div className={s.Main}>\r\n      <Header email={email}/>\r\n      <Form.Group controlId=\"search\" className={s.search}>\r\n          <Form.Label>Поиск</Form.Label>\r\n          <Form.Control type=\"search\" placeholder=\"Введите название компании\" value={search} onChange={handleChangeSearch}/>\r\n      </Form.Group>\r\n      { isLoaded &&\r\n        <div className={s.cardsContainer}>\r\n          <div className={s.cards}>\r\n            {\r\n              filteredFlights.map( flight => {\r\n                return  (\r\n                  <Card companyName={flight.company.name} date={flight.date} key={flight.id}/>\r\n                )\r\n              })\r\n            }\r\n          </div>\r\n        </div>\r\n      }\r\n    </div>\r\n)}\r\n\r\nexport default Main","import './App.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nimport React, { useEffect, useState } from 'react'\nimport {Switch, Route, Redirect} from \"react-router-dom\"\nimport { useDispatch, useSelector } from 'react-redux'\nimport { useHistory } from \"react-router-dom\";\n\nimport Auth from './components/Auth/Auth'\nimport Main from './components/Main/Main'\nimport { validateToken, getUser } from './utils/sdk';\nimport { saveLoginInfo } from './redux/actions';\n\nconst App = () => {\n\n  const dispatch = useDispatch()\n  const isAuth = useSelector( state => {\n    return Boolean(state.email && state.token)\n  })\n  let history = useHistory()\n  const [tokenChecked, setTokenChecked] = useState(false)\n\n  useEffect( () => {\n      let checkToken = async () => {\n        const token = localStorage.getItem(\"token\")\n        if (token) {\n          let isValid\n          try {\n            isValid = await validateToken(token)\n          }\n          catch {\n            isValid = false\n          }\n          if (isValid) {\n            let user = await getUser(token)\n            dispatch(saveLoginInfo({\n                email: user.email,\n                token\n            }))\n            history.push(getAuthRedirectURL(2))\n          } else {\n            localStorage.removeItem(\"token\")\n            alert(\"Ошибка авторизации\")\n            history.push(getNotAuthRedirectURL())\n          }\n        } else {\n            history.push(getNotAuthRedirectURL())\n        }\n        setTokenChecked(true)\n      }\n\n      checkToken()\n      //eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dispatch, history])\n\n  function getNotAuthRedirectURL() {\n    if (history.location.pathname === '/login') {\n      return history.location\n    }\n    let pathname = '/login'\n    if (history.location.pathname && history.location.pathname !== '/') {\n      return {\n        pathname,\n        search: `?redirect=${history.location.pathname}`\n      }\n    } else {\n      return pathname\n    }\n  }\n\n  function getAuthRedirectURL(arg) {\n    if (history.location.pathname !== '/login') {\n      return history.location\n    }\n    let pathname = '/profile'\n    let searchParams = new URLSearchParams(history.location.search)\n    let redirectURL = searchParams.get(\"redirect\")\n    if (redirectURL != null && redirectURL !== '/login') {\n      pathname = redirectURL\n    }\n    return pathname\n  }\n\n  return (\n\n    <div className=\"App\">\n      {tokenChecked &&\n        (!isAuth ?\n          <Switch>\n            <Route path=\"/login\">\n              <Auth/>\n            </Route>\n            <Redirect to={getNotAuthRedirectURL()}/>\n          </Switch>\n          :\n          <Switch>\n            <Route path=\"/profile\">\n              <Main/>\n            </Route>\n            <Redirect from=\"/login\" to={getAuthRedirectURL(1)}/>\n          </Switch>\n        )\n      }\n    </div>\n  );\n}\n\nexport default App;\n","import { createStore  } from 'redux'\r\nimport * as actions from './actions.js'\r\n\r\nlet initialState = {\r\n\temail: \"\",\r\n\ttoken: \"\"\r\n}\r\n\r\n\r\nfunction appReducer( state = initialState, action) {\r\n\tswitch (action.type) {\r\n\t\tcase actions.SAVE_LOGIN_INFO:\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\temail: action.email,\r\n\t\t\t\ttoken: action.token\r\n\t\t\t}\r\n\r\n\t\tdefault:\r\n\t\t\treturn state\r\n\t}\r\n}\r\n\r\nconst rootReducer = (state, action) => {\r\n\tif (actions.USER_LOGOUT) {\r\n\t\tlocalStorage.removeItem('token')\r\n\t\tstate = undefined\r\n\t}\r\n\treturn appReducer(state, action)\r\n  }\r\n  \r\nconst store = createStore(rootReducer, window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__())\r\n\r\nexport default store","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport {Provider} from 'react-redux'\nimport store from './redux/store.js'\n// import reportWebVitals from './reportWebVitals';\nimport { HashRouter as Router } from 'react-router-dom';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router basename={process.env.PUBLIC_URL}>\n      <Provider store={store}>\n        <App />\n      </Provider>\n    </Router>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals();\n"],"sourceRoot":""}